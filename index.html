<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />

    <title>ğŸ Editable installations - PEP-660 vs PEP-662 ğŸ</title>

    <script type="text/javascript" src="https://livejs.com/live.js"></script>
    <link rel="icon" type="image/x-icon" href="img/bloomberg_logo_github.png" />
    <link href="dist/reset.css" rel="stylesheet" />
    <link href="dist/reveal.css" rel="stylesheet" />
    <link href="dist/theme/white.css" id="theme" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

    <link href="plugin/highlight/github.css" id="highlight-theme" rel="stylesheet" />
    <style>
      .reveal pre {
        margin-top: 0;
        margin-bottom: 0;
        box-shadow: none;
        font-size: 0.5em;
      }

      .reveal code,
      pre > code {
        font-family: "Inconsolata Patched", monospace;
        text-rendering: geometricPrecision;
        font-variant-ligatures: none;
        line-height: 1;
      }

      @font-face {
        font-family: "Inconsolata Patched";
        src: local("Inconsolata Patched"),
          url("dist/theme/fonts/Inconsolata Regular Nerd Font Complete Mono.otf") format("opentype");
      }
      .maintain img {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h1>How we standardized</h1>
          <h1>editable installs</h1>
          <h5>PEP-660 vs. PEP-662</h5>
          <p>
            <small
              >by <a href="https://bernat.tech">Bernat Gabor</a> /
              <a href="https://twitter.com/gjbernat">@gjbernat</a> /
              <a href="https://github.com/bloomberg">Bloomberg</a>
            </small>
            <br />
            <a href="https://gaborbernat.github.io/pep-660-662-2022/">https://gaborbernat.github.io/pep-660-662-2022</a>
          </p>
        </section>

        <section>
          <h3>Who am I?</h3>
          <div>
            <ul>
              <li class="fragment">software engineer at Bloomberg (data ingestion and quality control)</li>
              <li class="fragment">
                OSS contributor <a href="https://github.com/gaborbernat">@ github/gaborbernat</a>, blog
                <a href="https://bernat.tech/about/">bernat.tech</a>
              </li>
              <li class="fragment">
                member of the <span style="color: orange">Py</span>thon <span style="color: orange">P</span>ackaging
                <span style="color: orange">A</span>uthority (<span style="color: orange; font-style: italic"
                  >virtualenv</span
                >, <span style="color: orange; font-style: italic">build</span>,
                <span style="color: orange; font-style: italic">pipx</span>,
                <span style="color: darkorange; font-style: italic">tox</span> maintainer)
              </li>
              <li class="fragment">ğŸ˜ parent to two Yorkshire Terriers</li>
            </ul>
            <div class="fragment">
              <img
                alt="Silky"
                src="./img/silky_junior.jpg"
                style="width: 50%; margin-left: auto; margin-right: auto; margin-bottom: 0"
              />
              <p style="font-size: 12px; margin: 0 0">Copyright of the above image owned by Bernat Gabor</p>
            </div>
          </div>
        </section>

        <section>
          <h3>Maintainer (author *) of Python OSS projects</h3>
          <ul class="maintain">
            <li>
              <a href="https://github.com/platformdirs/platformdirs"><strong>platformdirs</strong></a> -
              <a href="https://pypistats.org/packages/platformdirs">
                <img src="https://img.shields.io/pypi/dm/platformdirs?style=flat-square" alt="PyPI - Downloads" />
              </a>
            </li>
            <li>
              <a href="https://github.com/tox-dev/py-filelock"><strong>filelock</strong></a> â€“
              <a href="https://pypistats.org/packages/filelock">
                <img src="https://img.shields.io/pypi/dm/filelock?style=flat-square" alt="PyPI - Downloads" />
              </a>
            </li>

            <li>
              <a href="https://github.com/pypa/virtualenv"><strong>virtualenv</strong></a> -
              <a href="https://pypistats.org/packages/virtualenv">
                <img src="https://img.shields.io/pypi/dm/virtualenv?style=flat-square" alt="PyPI - Downloads" />
              </a>
            </li>
            <li>
              <a href="https://github.com/tox-dev/tox"><strong>tox</strong></a> -
              <a href="https://pypistats.org/packages/tox">
                <img src="https://img.shields.io/pypi/dm/tox?style=flat-square" alt="PyPI - Downloads" />
              </a>
            </li>
            <li>
              <a href="https://github.com/pypa/build">build</a> -
              <a href="https://pypistats.org/packages/build"
                ><img src="https://img.shields.io/pypi/dm/build?style=flat-square" alt="PyPI - Downloads"
              /></a>
            </li>
            <li>
              <a href="https://github.com/tox-dev/sphinx-autodoc-typehints"
                ><strong>sphinx-autodoc-typehints</strong></a
              >
              -
              <a href="https://pypistats.org/packages/sphinx-autodoc-typehints"
                ><img
                  src="https://img.shields.io/pypi/dm/sphinx-autodoc-typehints?style=flat-square"
                  alt="PyPI - Downloads"
              /></a>
            </li>
            <li>
              <a href="https://github.com/pypa/pipx">pipx</a> -
              <a href="https://pypistats.org/packages/pipx"
                ><img src="https://img.shields.io/pypi/dm/pipx?style=flat-square" alt="PyPI - Downloads"
              /></a>
            </li>
            <li>
              <a href="https://github.com/pypa/flit">flit</a> -
              <a href="https://pypistats.org/packages/flit"
                ><img src="https://img.shields.io/pypi/dm/flit?style=flat-square" alt="PyPI - Downloads"
              /></a>
            </li>
            <li>...</li>
          </ul>
        </section>

        <section>
          <h1>What is an editable installation?</h1>
        </section>

        <section>
          <div>
            <img
              alt="Eager"
              src="./img/junior_ball.jpg"
              style="width: 50%; margin-left: auto; margin-right: auto; margin-bottom: 0"
            />
            <p style="font-size: 12px; margin: 0 0">Copyright of the above image owned by Bernat Gabor</p>
          </div>
        </section>

        <section>
          <h3>What is an editable installation?</h3>
          <ul>
            <li>
              Let there be the following Python project
              <pre><code class="lang-bash" data-trim data-noescape>
                ï„• .
                â”œâ”€â”€ ï€– pyproject.toml
                â””â”€â”€ ï„• src
                   â””â”€â”€ ï„• demo
                      â””â”€â”€ î˜† __init__.py
              </code></pre>
            </li>
            <li>
              <span style="font-style: italic"
                >pyproject.toml <a href="https://peps.python.org/pep-0621/">(PEP-621 style)</a></span
              >
              <pre><code class="lang-toml" data-trim data-noescape>
              [build-system]
              build-backend = "hatchling.build"
              requires = ["hatchling>=0.14"]

              [project]
              name = "demo"
              version = "1.0"
              </code></pre>
            </li>
            <li>
              <span style="font-style: italic">src/demo/__init__.py</span>
              <pre><code class="lang-python" data-trim data-noescape>
              def say_hi(name: str) -> None:
                print(f"Hello {name}")
              </code></pre>
            </li>
            <li class="fragment">
              How do we run it?
              <pre><code class="lang-bash" data-trim data-noescape>
              $ python -c 'from demo import say_hi; say_hi("Me")'
              Traceback (most recent call last):
                File "&lt;string&gt;", line 1, in &lt;module&gt;
              ModuleNotFoundError: No module named 'demo'
              </code></pre>
            </li>
          </ul>
        </section>

        <section>
          <h3>What is an editable installation?</h3>
          <ol>
            To test the library, we need to install it in an isolated virtual environment. For example:
            <li class="fragment">
              create isolated virtual environment
              <pre><code class="lang-bash" data-trim data-noescape>
              $ virtualenv venv --clear --no-wheel --no-setuptools --activators ""
              created virtual environment CPython3.10.4.final.0-64 in 88ms
                creator CPython3Posix(dest=/tmp/prj/venv, clear=True, no_vcs_ignore=False, global=False)
                seeder FromAppData(download=False, pip=bundle, via=copy, app_data_dir=/tmp/virtualenv)
                  added seed packages: pip==22.0.4
              </code></pre>
            </li>
            <li class="fragment">
              install the library
              <pre><code class="lang-bash" data-trim data-noescape>
                $ venv/bin/pip install .
                Processing /tmp/prj
                  Installing build dependencies ... done
                  Getting requirements to build wheel ... done
                  Preparing metadata (pyproject.toml) ... done
                Building wheels for collected packages: demo
                  Building wheel for demo (pyproject.toml) ... done
                  Created wheel for demo: filename=demo-1.0-py2.py3-none-any.whl size=1089 sha256=4af9f4008bef1f029
                  Stored in directory: /tmp/pip-ephem-wheel-cache-1t02m0nm/wheels/41/8a/ba/ffb94b3ccf1b5c11339
                Successfully built demo
                Installing collected packages: demo
                Successfully installed demo-1.0
                </code></pre>
            </li>
            <li class="fragment">
              run the test code
              <pre><code class="lang-bash" data-trim data-noescape>
              $ venv/bin/python -c 'from demo import say_hi; say_hi("Me")'
              Hello Me
              </code></pre>
            </li>
          </ol>
        </section>

        <section>
          <h3>What is an editable installation?</h3>
          <ul>
            What will happen when I change the library code inside the projects source directory?
            <li>
              change <span style="font-style: italic">src/demo/__init__.py</span>
              <pre><code class="lang-python" data-trim data-noescape>
              def say_hi(name: str) -> None:
                print(f"Hello {name}<mark>!</mark>")
              </code></pre>
            </li>
            <li>
              and run the test code again
              <pre><code class="lang-bash" data-trim data-noescape>
              $ venv/bin/python -c 'from demo import say_hi; say_hi("Me")'
              Hello Me
              </code></pre>
            </li>
            <div class="fragment">
              <li>
                install the library
                <pre><code class="lang-bash" data-trim data-noescape>
                  $ venv/bin/pip install .
                  Processing /tmp/prj
                    Installing build dependencies ... done
                    Getting requirements to build wheel ... done
                    Preparing metadata (pyproject.toml) ... done
                  Building wheels for collected packages: demo
                    Building wheel for demo (pyproject.toml) ... done
                    Created wheel for demo: filename=demo-1.0-py2.py3-none-any.whl size=1089 sha256=4af9f4008bef1f029
                    Stored in directory: /tmp/pip-ephem-wheel-cache-1t02m0nm/wheels/41/8a/ba/ffb94b3ccf1b5c11339
                  Successfully built demo
                  Installing collected packages: demo
                  Successfully installed demo-1.0
                  </code></pre>
              </li>
              <li>
                run the test code
                <pre><code class="lang-bash" data-trim data-noescape>
                $ venv/bin/python -c 'from demo import say_hi; say_hi("Me")'
                Hello Me!
                </code></pre>
              </li>
            </div>
          </ul>
        </section>

        <section>
          <h3>What is an editable installation?</h3>
          <ul>
            <li>
              Having to install the project after every code change slows down development <br />
              <div class="fragment">
                <img
                  data-src="img/better_way.gif"
                  style="margin-left: auto; margin-right: auto; display: block; width: 50%"
                />
                <p style="font-size: 12px; margin-left: auto; margin-right: auto; display: block; width: 25%">
                  Copyright of the above image owned by
                  <a href="https://www.streamerclips.com/gifs/lepsi/welltododamagedcollie">StreamClips</a>
                </p>
              </div>
            </li>
          </ul>
        </section>

        <section>
          <h3>What is an editable installation?</h3>

          <ul>
            Editable install ensures subsequent code changes take effect without a reinstallation
            <div class="fragment">
              <li>
                install the library in editable mode
                <pre><code class="lang-bash" data-trim data-noescape>
                  $ venv/bin/pip install <mark>-e</mark> .
                  Processing /tmp/prj
                    Installing build dependencies ... done
                    Getting requirements to build wheel ... done
                    Preparing metadata (pyproject.toml) ... done
                  Building wheels for collected packages: demo
                    Building wheel for demo (pyproject.toml) ... done
                    Created wheel for demo: filename=demo-1.0-py2.py3-none-any.whl size=1089 sha256=4af9f4008bef1f029f9ae06fdd752a1e36c
                    Stored in directory: /tmp/pip-ephem-wheel-cache-1t02m0nm/wheels/41/8a/ba/ffb94b3ccf1b5c11339bf57ad6563
                  Successfully built demo
                  Installing collected packages: demo
                  Successfully installed demo-1.0
                  </code></pre>
              </li>
              <li>
                run the test code
                <pre><code class="lang-bash" data-trim data-noescape>
                $ venv/bin/python -c 'from demo import say_hi; say_hi("Me")'
                Hello Me
                </code></pre>
              </li>
              <li>
                change <span style="font-style: italic">src/demo/__init__.py</span>
                <pre><code class="lang-python" data-trim data-noescape>
                def say_hi(name: str) -> None:
                  print(f"Hello {name}<mark>!</mark>")
                </code></pre>
              </li>
              <li>
                run the test code
                <pre><code class="lang-bash" data-trim data-noescape>
                $ venv/bin/python -c 'from demo import say_hi; say_hi("Me")'
                Hello Me!
                </code></pre>
              </li>
            </div>
          </ul>
        </section>

        <section>
          <h1>Prior art</h1>
          <div>
            <img
              alt="Curios"
              src="./img/silky_hill.jpg"
              style="width: 75%; margin-left: auto; margin-right: auto; margin-bottom: 0"
            />
            <p style="font-size: 12px; margin: 0 0">Copyright of the above image owned by Bernat Gabor</p>
          </div>
        </section>

        <section>
          <h2>Prior art</h2>
          <ul>
            <li>
              Initially introduced with <span style="font-style: italic">distutils</span> and inherited by
              <span style="font-style: italic">setuptools</span> under the interface
              <pre><code class="lang-bash" data-trim data-noescape>
              $ python setup.py develop
              </code></pre>
            </li>
            <li>
              Used by
              <a href="https://pip.pypa.io/en/stable/news/#v21-3">pip until version 21.3 (released on 2021-10-11)</a>:
              <pre><code class="lang-bash" data-trim data-noescape>
              $ python -m pip install -e /path/to/project
              # under the hood calls - <mark>python setup.py develop with current working directory of /path/to/project</mark>
              </code></pre>
            </li>
          </ul>
        </section>

        <section>
          <h2>Prior art - Normal installation</h2>

          <pre><code class="lang-bash" data-trim data-noescape>
          ï„• .
          â”œâ”€â”€ ï€– pyproject.toml
          â””â”€â”€ ï„• src
              â””â”€â”€ ï„• demo
                â””â”€â”€ î˜† __init__.py
          </code></pre>
          <pre><code class="lang-bash" data-trim data-noescape>
          $ venv/bin/pip install .
          Processing /tmp/prj
            Installing build dependencies ... done
            Getting requirements to build wheel ... done
            Preparing metadata (pyproject.toml) ... done
          Building <mark>wheels</mark> for collected packages: demo
            Building wheel for demo (pyproject.toml) ... done
            <mark>Created wheel for demo: filename=demo-1.0-py2.py3-none-any.whl size=1089 sha256=4af9f4008bef1f029f9ae06fdd752a1e36c</mark>
            Stored in directory: /tmp/pip-ephem-wheel-cache-1t02m0nm/wheels/41/8a/ba/ffb94b3ccf1b5c11339bf57ad6563
          Successfully built demo
          Installing collected packages: demo
          Successfully installed demo-1.0
          </code></pre>

          <pre class="fragment"><code class="lang-bash" data-trim data-noescape>

          $ zipinfo -1 demo-1.0-py2.py3-none-any.whl
          <mark>demo/__init__.py</mark>
          demo-1.0.dist-info/METADATA
          demo-1.0.dist-info/WHEEL
          demo-1.0.dist-info/entry_points.txt
          demo-1.0.dist-info/RECORD
          </code></pre>
        </section>

        <section>
          <h2>Prior art - Normal installation</h2>

          <pre><code class="lang-bash" data-trim data-noescape>
          ï„• .
          â”œâ”€â”€ ï€– pyproject.toml
          â””â”€â”€ ï„• src
              â””â”€â”€ ï„• demo
                â””â”€â”€ î˜† __init__.py
          </code></pre>
          <pre><code class="lang-bash" data-trim data-noescape>
          $ venv/bin/pip install .
          Processing /tmp/prj
            Installing build dependencies ... done
            Getting requirements to build wheel ... done
            Preparing metadata (pyproject.toml) ... done
          Building <mark>wheels</mark> for collected packages: demo
            Building wheel for demo (pyproject.toml) ... done
            <mark>Created wheel for demo: filename=demo-1.0-py2.py3-none-any.whl size=1089 sha256=4af9f4008bef1f029f9ae06fdd752a1e36c</mark>
            Stored in directory: /tmp/pip-ephem-wheel-cache-1t02m0nm/wheels/41/8a/ba/ffb94b3ccf1b5c11339bf57ad6563
          Successfully built demo
          Installing collected packages: demo
          Successfully installed demo-1.0
          </code></pre>

          <pre><code class="lang-bash" data-trim data-noescape>

          $ zipinfo -1 demo-1.0-py2.py3-none-any.whl
          demo/__init__.py
          <mark>demo-1.0.dist-info/METADATA
          demo-1.0.dist-info/WHEEL
          demo-1.0.dist-info/entry_points.txt
          demo-1.0.dist-info/RECORD</mark>
          </code></pre>
        </section>
        <section>
          <h2>Prior art - Normal installation</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
            $ venv/bin/pip install .
            Processing /tmp/prj
              Installing build dependencies ... done
              Getting requirements to build wheel ... done
              Preparing metadata (pyproject.toml) ... done
            Building wheels for collected packages: demo
              Building wheel for demo (pyproject.toml) ... done
              Created wheel for demo: filename=demo-1.0-py2.py3-none-any.whl size=1089 sha256=4af9f4008bef1f029f9ae06fdd752a1e36c
              Stored in directory: /tmp/pip-ephem-wheel-cache-1t02m0nm/wheels/41/8a/ba/ffb94b3ccf1b5c11339bf57ad6563
            Successfully built demo
            <mark>Installing collected packages: demo</mark>
            Successfully installed demo-1.0

            </code></pre>

          <pre><code class="lang-bash" data-trim data-noescape>

              $ zipinfo -1 demo-1.0-py2.py3-none-any.whl
              demo/__init__.py
              demo-1.0.dist-info/METADATA
              demo-1.0.dist-info/WHEEL
              demo-1.0.dist-info/entry_points.txt
              demo-1.0.dist-info/RECORD
              </code></pre>

          <pre class="fragment"><code class="lang-bash" data-trim data-noescape>

            $ lsd --tree venv/lib/python3.10/site-packages/demo*
            ï„• venv/lib/python3.10/site-packages/demo
            â”œâ”€â”€ î˜† __init__.py
            â””â”€â”€ ï„• __pycache__
              â””â”€â”€ î˜† __init__.cpython-310.pyc
            ï„• venv/lib/python3.10/site-packages/demo-1.0.dist-info
            â”œâ”€â”€ î˜‹ direct_url.json
            â”œâ”€â”€ ï…œ entry_points.txt
            â”œâ”€â”€ ï€– INSTALLER
            â”œâ”€â”€ ï€– METADATA
            â”œâ”€â”€ ï€– RECORD
            â”œâ”€â”€ ï€– REQUESTED
            â””â”€â”€ ï€– WHEEL
            </code></pre>
        </section>

        <section>
          <h2>Prior art - Normal installation</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
            $ venv/bin/pip install .
            Processing /tmp/prj
              Installing build dependencies ... done
              Getting requirements to build wheel ... done
              Preparing metadata (pyproject.toml) ... done
            Building wheels for collected packages: demo
              Building wheel for demo (pyproject.toml) ... done
              Created wheel for demo: filename=demo-1.0-py2.py3-none-any.whl size=1089 sha256=4af9f4008bef1f029f9ae06fdd752a1e36c
              Stored in directory: /tmp/pip-ephem-wheel-cache-1t02m0nm/wheels/41/8a/ba/ffb94b3ccf1b5c11339bf57ad6563
            Successfully built demo
            <mark>Installing collected packages: demo</mark>
            Successfully installed demo-1.0

            </code></pre>

          <pre><code class="lang-bash" data-trim data-noescape>

              $ zipinfo -1 demo-1.0-py2.py3-none-any.whl
              <mark>demo/__init__.py</mark>
              demo-1.0.dist-info/METADATA
              demo-1.0.dist-info/WHEEL
              demo-1.0.dist-info/entry_points.txt
              demo-1.0.dist-info/RECORD
              </code></pre>

          <pre><code class="lang-bash" data-trim data-noescape>

          $ lsd --tree venv/lib/python3.10/site-packages/demo*
          <mark>ï„• venv/lib/python3.10/site-packages/demo
          â”œâ”€â”€ î˜† __init__.py
          â””â”€â”€ ï„• __pycache__
            â””â”€â”€ î˜† __init__.cpython-310.pyc</mark>
          ï„• venv/lib/python3.10/site-packages/demo-1.0.dist-info
          â”œâ”€â”€ î˜‹ direct_url.json
          â”œâ”€â”€ ï…œ entry_points.txt
          â”œâ”€â”€ ï€– INSTALLER
          â”œâ”€â”€ ï€– METADATA
          â”œâ”€â”€ ï€– RECORD
          â”œâ”€â”€ ï€– REQUESTED
          â””â”€â”€ ï€– WHEEL
            </code></pre>
        </section>

        <section>
          <h2>Prior art - Normal installation</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
            $ venv/bin/pip install .
            Processing /tmp/prj
              Installing build dependencies ... done
              Getting requirements to build wheel ... done
              Preparing metadata (pyproject.toml) ... done
            Building wheels for collected packages: demo
              Building wheel for demo (pyproject.toml) ... done
              Created wheel for demo: filename=demo-1.0-py2.py3-none-any.whl size=1089 sha256=4af9f4008bef1f029f9ae06fdd752a1e36c
              Stored in directory: /tmp/pip-ephem-wheel-cache-1t02m0nm/wheels/41/8a/ba/ffb94b3ccf1b5c11339bf57ad6563
            Successfully built demo
            <mark>Installing collected packages: demo</mark>
            Successfully installed demo-1.0

            </code></pre>

          <pre><code class="lang-bash" data-trim data-noescape>

              $ zipinfo -1 demo-1.0-py2.py3-none-any.whl
              demo/__init__.py
              <mark>demo-1.0.dist-info/METADATA
              demo-1.0.dist-info/WHEEL
              demo-1.0.dist-info/entry_points.txt
              demo-1.0.dist-info/RECORD</mark>
              </code></pre>

          <pre><code class="lang-bash" data-trim data-noescape>

            $ lsd --tree venv/lib/python3.10/site-packages/demo*
            ï„• venv/lib/python3.10/site-packages/demo
            â”œâ”€â”€ î˜† __init__.py
            â””â”€â”€ ï„• __pycache__
              â””â”€â”€ î˜† __init__.cpython-310.pyc
            <mark>ï„• venv/lib/python3.10/site-packages/demo-1.0.dist-info
            â”œâ”€â”€ î˜‹ direct_url.json
            â”œâ”€â”€ ï…œ entry_points.txt
            â”œâ”€â”€ ï€– INSTALLER
            â”œâ”€â”€ ï€– METADATA
            â”œâ”€â”€ ï€– RECORD
            â”œâ”€â”€ ï€– REQUESTED
            â””â”€â”€ ï€– WHEEL</mark>
            </code></pre>

          <!-- prettier-ignore -->
          <div class="mermaid">
            graph LR
              S[Source directory]
              W[Built wheel]
              SP[site-packages]
              P[Python executable]
              S -->|copy| W
              W -->|extract - copy| SP
              SP -.-|import demo| P
          </div>
        </section>

        <section>
          <h2>Prior art - Editable installation</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
            ï„• .
            â”œâ”€â”€ î˜† setup.py
            â””â”€â”€ ï„• src
              â””â”€â”€ ï„• demo
                  â””â”€â”€ î˜† __init__.py
            </code></pre>
          <br />

          <pre><code class="lang-python" data-trim data-noescape>
          from setuptools import setup

          setup(
              name="demo",
              version="1.0",
              package_dir={"": "src"},
              packages=["demo"],
          )
           </code></pre>

          <br />

          <pre><code class="lang-bash" data-trim data-noescape>
           $ virtualenv venv --clear --no-wheel --pip 21.2 --activators ""
           created virtual environment CPython3.10.4.final.0-64 in 101ms
           added seed packages: pip==21.2, setuptools==62.1.0
          </code></pre>
          <br />
          <pre><code class="lang-bash" data-trim data-noescape>
           $ venv/bin/pip install -e .
           Obtaining file:///home/bernat/git/pep-660-662-2022/prj
           Installing collected packages: demo
             <mark>Running setup.py develop for demo</mark>
           Successfully installed demo-1.0
           </code></pre>
        </section>

        <section>
          <h2>Prior art - Editable installation</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
            ï„• .
            â”œâ”€â”€ î˜† setup.py
            â””â”€â”€ ï„• src
              â”œâ”€â”€ ï„• demo
              â”‚  â””â”€â”€ î˜† __init__.py
              <mark>â””â”€â”€ ï„• demo.egg-info
                  â”œâ”€â”€ ï…œ dependency_links.txt
                  â”œâ”€â”€ ï€– PKG-INFO
                  â”œâ”€â”€ ï…œ SOURCES.txt
                  â””â”€â”€ ï…œ top_level.txt</mark>
            </code></pre>

          <br />

          <pre><code class="lang-bash" data-trim data-noescape>
            $ cat <mark>venv/lib/python3.10/site-packages/easy-install.pth</mark>
            /tmp/prj/src
            </code></pre>
          <br />
          <pre><code class="lang-bash" data-trim data-noescape>
          $ venv/bin/python -m site
          sys.path = [
              '/tmp/prj',
              '/usr/lib/python310.zip',
              '/usr/lib/python3.10',
              '/usr/lib/python3.10/lib-dynload',
              '/tmp/prj/venv/lib/python3.10/site-packages',
              <mark>'/tmp/prj/src',</mark>
          ]
          USER_BASE: '/home/bernat/.local' (exists)
          USER_SITE: '/home/bernat/.local/lib/python3.10/site-packages' (exists)
          ENABLE_USER_SITE: False
          </code></pre>
          <!-- prettier-ignore -->
          <div class="mermaid">
            graph LR
              S[Source directory]
              P[Python executable]
              S -.-|import demo| P
              S -->|build metadata and install pth file to resolve imports| S
          </div>
        </section>

        <section>
          <h2>Prior art - Editable installation</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
            ï„• .
            â”œâ”€â”€ î˜† setup.py
            â””â”€â”€<mark> ï„• src</mark>
              â”œâ”€â”€ ï„• demo
              â”‚  â””â”€â”€ î˜† __init__.py
              â””â”€â”€ ï„• demo.egg-info
                  â”œâ”€â”€ ï…œ dependency_links.txt
                  â”œâ”€â”€ ï€– PKG-INFO
                  â”œâ”€â”€ ï…œ SOURCES.txt
                  â””â”€â”€ ï…œ top_level.txt
            </code></pre>

          <br />

          <pre><code class="lang-bash" data-trim data-noescape>
            $ cat venv/lib/python3.10/site-packages/easy-install.pth
            <mark>/tmp/prj/src</mark>
            </code></pre>
          <br />
          <pre><code class="lang-bash" data-trim data-noescape>
          $ venv/bin/python -m site
          sys.path = [
              '/tmp/prj',
              '/usr/lib/python310.zip',
              '/usr/lib/python3.10',
              '/usr/lib/python3.10/lib-dynload',
              '/tmp/prj/venv/lib/python3.10/site-packages',
              <mark>'/tmp/prj/src',</mark>
          ]
          USER_BASE: '/home/bernat/.local' (exists)
          USER_SITE: '/home/bernat/.local/lib/python3.10/site-packages' (exists)
          ENABLE_USER_SITE: False
          </code></pre>

          <!-- prettier-ignore -->
          <div class="mermaid">
            graph LR
              S[Source directory]
              P[Python executable]
              S -.-|import demo| P
              S -->|build metadata and install pth file to resolve imports| S
          </div>
        </section>

        <section>
          <h2>Is this problem solved?</h2>
          <ul>
            <li>
              No, because the solution still requires the presence of the legacy
              <span style="font-style: italic">setup.py</span> file
            </li>
            <li>What an editable installation is and how it should work was never agreed upon</li>
            <li>Prior art is an implementation detail of a tool</li>
            <li class="fragment">
              Why did we not do it before? <span class="fragment">We did try!</span
              ><span class="fragment"> (more than once)</span>
              <ul>
                <li class="fragment">
                  2015 -
                  <a href="https://peps.python.org/pep-0517/#get-requires-for-build-sdist"
                    >part of PEP-517 (standardization of the normal builds)</a
                  >
                </li>
                <li class="fragment">
                  2019 April -
                  <a href="https://discuss.python.org/t/pip-freeze-vcs-urls-and-pep-517-feat-editable-installs/1473"
                    >part of the PyCon US 2019 packaging summit</a
                  >
                </li>
                <li class="fragment">
                  2019 May -
                  <a href="https://discuss.python.org/t/specification-of-editable-installation/1564">
                    follow-up discussion to the decision at the summit</a
                  >
                </li>
                <li class="fragment">
                  2020 April -
                  <a href="https://discuss.python.org/t/third-try-on-editable-installs/3986">
                    third try on editable installs</a
                  >
                </li>
                <li class="fragment">
                  2021 April -
                  <a href="https://peps.python.org/pep-0660/"> Editable installs for pyproject.toml based builds</a>
                </li>
                <li class="fragment">
                  2021 May -
                  <a href="https://peps.python.org/pep-0662/">Editable installs via virtual wheels</a>
                </li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h1>Drawbacks of the prior art</h1>
          <div>
            <img
              alt="Not all sunshine"
              src="./img/silky_sun.jpg"
              style="width: 50%; margin-left: auto; margin-right: auto; margin-bottom: 0"
            />
            <p style="font-size: 12px; margin: 0 0">Copyright of the above image owned by Bernat Gabor</p>
          </div>
        </section>

        <section>
          <h3>Files to add to package not validated</h3>
          <pre><code class="lang-python" data-trim data-noescape>
          from setuptools import setup

          setup(
              name="demo",
              version="1.0",
              package_dir={"": "src"},
              <mark>packages=["demo"]</mark>,
          )
          </code></pre>
          <br />
          <pre><code class="lang-bash" data-trim data-noescape>
          ï„• .
          â”œâ”€â”€ î˜† setup.py
          â””â”€â”€ ï„• src
            â”œâ”€â”€ ï„• demo
            â”‚  â””â”€â”€ î˜† __init__.py  
            â”œâ”€â”€ <mark>ï„• magic</mark>
            â”‚  â””â”€â”€ <mark>î˜† __init__.py</mark>
            â””â”€â”€ ï„• demo.egg-info
                â”œâ”€â”€ ï…œ dependency_links.txt
                â”œâ”€â”€ ï€– PKG-INFO
                â”œâ”€â”€ ï…œ SOURCES.txt
                â””â”€â”€ ï…œ top_level.txt
          </code></pre>
          <ul>
            <li>
              editable installation will pick up <span style="font-style: italic; color: gray">import magic</span>
            </li>
            <li>
              normal installation will not pick package magic
              <span style="font-style: italic; color: gray">import magic</span>
            </li>
          </ul>
        </section>

        <section>
          <h3>Files to exclude from package not validated</h3>
          <pre><code class="lang-python" data-trim data-noescape>
            from setuptools import setup
  
            setup(
                name="demo",
                version="1.0",
                package_dir={"": "src"},
                packages=["demo"],
                <mark>exclude=["demo.tests"],</mark>
            )
            </code></pre>
          <br />
          <pre><code class="lang-bash" data-trim data-noescape>
            ï„• .
            â”œâ”€â”€ î˜† setup.py
            â””â”€â”€ ï„• src
              â”œâ”€â”€ ï„• demo
              â”‚  â”œâ”€â”€  î˜† __init__.py
              â”‚  â””â”€â”€ ï„•  <mark>tests</mark>
              â”‚     â””â”€â”€ <mark>î˜† __init__.py</mark>
              â””â”€â”€ ï„• demo.egg-info
                  â”œâ”€â”€ ï…œ dependency_links.txt
                  â”œâ”€â”€ ï€– PKG-INFO
                  â”œâ”€â”€ ï…œ SOURCES.txt
                  â””â”€â”€ ï…œ top_level.txt
            </code></pre>
          <ul>
            <li>
              editable installation will allow you to run
              <span style="font-style: italic; color: gray">import demo.tests</span>
            </li>
            <li>
              normal installation will fail
              <span style="font-style: italic; color: gray">import demo.tests</span>
            </li>
          </ul>
        </section>

        <section>
          <h3>No support for generated code</h3>
          <ul>
            <li>
              you get JSON/OpenAPI schema to a service - generate Python objects from it
              <pre><code class="lang-json" data-trim data-noescape>            
                {
                  "type": "object",
                  "properties": {
                    "firstName": {
                      "type": "string",
                      "description": "The person's first name."
                    }
                  }
                }
              </code></pre>
            </li>
            <li>
              for example, PyDantic objects via
              <a href="https://pypi.org/project/datamodel-code-generator/">datamodel-code-generator</a>
              <pre><code class="lang-python" data-trim data-noescape>            
                $ datamodel-codegen --input schema.json
                # generated by datamodel-codegen:
                #   filename:  schema.json
                #   timestamp: 2022-04-17T15:16:32+00:00

                from __future__ import annotations

                from typing import Optional

                from pydantic import BaseModel, Field


                class Model(BaseModel):
                    firstName: Optional[str] = Field(None, description="The person's first name.")
              </code></pre>
            </li>
          </ul>
        </section>

        <section>
          <h3>No support for C-extensions</h3>
          <ul>
            <li>
              for example, a <a href="https://cython.org/">Cython powered project</a>

              <pre><code class="lang-bash" data-trim data-noescape>
                ï„• .
                â”œâ”€â”€ î˜† setup.py
                â””â”€â”€ ï„• src
                  â””â”€â”€ ï„• demo
                     â”œâ”€â”€  î˜† __init__.py
                     â””â”€â”€  <mark>î˜† _demo.pyx</mark>  
                </code></pre>
            </li>
            <li class="fragment">
              an editable build generates (compiles) native code at install time only
              <pre><code class="lang-bash" data-trim data-noescape>
                ï„• .
                â”œâ”€â”€ î˜† setup.py
                â””â”€â”€ ï„• src
                  â”œâ”€â”€ ï„• demo
                  â”‚  â”œâ”€â”€  î˜† __init__.py
                  â”‚  â”œâ”€â”€  î˜† _demo.pyx
                  â”‚  â””â”€â”€  <mark>ï€–  _demo.cpython-310-x86_64-linux-gnu.so*</mark>
                  â””â”€â”€ ï„• <mark>demo.egg-info</mark>
                      â”œâ”€â”€ ï…œ dependency_links.txt
                      â”œâ”€â”€ ï€– PKG-INFO
                      â”œâ”€â”€ ï…œ SOURCES.txt
                      â””â”€â”€ ï…œ top_level.txt
                </code></pre>
            </li>
          </ul>
        </section>

        <section>
          <h1>New approaches</h1>
          <div>
            <img
              alt="Eager"
              src="./img/junior_coming.jpg"
              style="width: 40%; margin-left: auto; margin-right: auto; margin-bottom: 0"
            />
            <p style="font-size: 12px; margin: 0 0">Copyright of the above image owned by Bernat Gabor</p>
          </div>
        </section>

        <section>
          <h2>Life without a PTH file?</h2>
          <img data-src="img/pth.png" />
        </section>

        <section>
          <h2>Symlinks - Folder</h2>
          <ul>
            <li>Available on UNIX, Windows 7+ supports it (with a potential one-time setup)</li>
            <li class="fragment">
              Symlink each file from within the source directory to site-packages at build time
              <pre><code class="lang-bash" data-trim data-noescape>
                $ lsd -tree /tmp/prj
                ï„• . 
                â”œâ”€â”€ ï€– pyproject.toml
                â””â”€â”€ ï„• src
                    â””â”€â”€ ï„• demo
                      â””â”€â”€ î˜† __init__.py
                </code></pre>
              <br />

              <pre><code class="lang-bash" data-trim data-noescape>
              $ lsd -alth venv/lib/python3.10/site-packages/demo
              drwxr-xr-x bernat bernat 131 B  Sun Apr 17 17:30:12 2022 ï„• .
              lrwxrwxrwx bernat bernat  46 B  Sun Apr 17 17:30:12 2022 ï’‚ demo â‡’ /tmp/prj/src/demo
              </code></pre>

              <ul>
                <ul>
                  <li>No startup performance impact</li>
                  <li>File paths mirror normal installation</li>
                  <li>New files added are automatically included but does not allow exclusion</li>
                </ul>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h2>Symlinks - Files</h2>
          <ul>
            <li>
              Symlink each file from within the source directory to site-packages at build time
              <pre><code class="lang-bash" data-trim data-noescape>
                $ lsd -tree /tmp/prj
                ï„• . 
                â”œâ”€â”€ ï€– pyproject.toml
                â””â”€â”€ ï„• src
                    â”‚â”€â”€ ï„• demo
                    â”‚  â””â”€â”€ î˜† __init__.py
                    â””â”€â”€ î˜† test_demo.py
                </code></pre>
              <br />
              <pre><code class="lang-bash" data-trim data-noescape>
                $ lsd -alth venv/lib/python3.10/site-packages/demo
                drwxr-xr-x bernat bernat  25 B Sun Apr 17 17:36:40 2022 ï„• .
                lrwxrwxrwx bernat bernat  58 B Sun Apr 17 17:36:14 2022 ï’ __init__.py â‡’ /tmp/prj/src/demo/__init__.py
                </code></pre>

              <ul>
                <ul>
                  <li>No startup performance impact</li>
                  <li>File paths mirror normal installation</li>
                  <li>Allows file level inclusion/exclusion but new files require reinstall</li>
                </ul>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h2>Import hooks</h2>
          <ul>
            <li>We're importing modules, not files, let's use that!</li>
            <li>Extend the import system to manifest the module at import time</li>
            <li>Fully dynamic (load packaging config at first import, and validate config/file system)!</li>
            <li>
              Brainstormed together with Paul Moore in 2020 - he released it as the
              <a href="https://pypi.org/project/editables">editables</a> library
            </li>
          </ul>
        </section>

        <section>
          <h2>Import hooks</h2>
          <ul>
            <li>
              Generates a PTH file that handles system initialization
              <pre><code class="lang-bash" data-trim data-noescape>
              .rw-r--r-- ï€– venv/lib/python3.10/site-packages/demo.pth
              .rw-r--r-- î˜† venv/lib/python3.10/site-packages/_editable_impl_demo.py
              </code></pre>
            </li>
            <li>
              Just load the import logic
              <pre><code class="lang-python" data-trim data-noescape>
              import _editable_impl_pyproject_fmt
              </code></pre>
            </li>
            <li>
              Register the editable import hook and define how modules map to source files
              <pre><code class="lang-python" data-trim data-noescape>
              from editables.redirector import RedirectingFinder as F
              F.install()  # install import editables import hook to sys.meta_path
              F.map_module('demo', '/tmp/prj/src/demo/__init__.py')   # register module name to source file
              </code></pre>
            </li>
            <li class="fragment">
              Solves (all) our problems, it as supports:
              <ul>
                <li>
                  <span style="font-style: italic">addition</span> of new files as it would check during import if
                  exists
                </li>
                <li>
                  <span style="font-style: italic">exclusion</span> of files as it could check during the import if
                  excluded and skip
                </li>
                <li><span style="font-style: italic">generate code</span> from JSONSpec/OpenAPI during the import</li>
                <li>
                  <span style="font-style: italic">recompile/build</span> C-extension modules on import if the source
                  file has been changed since last build
                </li>
              </ul>
            </li>
          </ul>

          <br />

          <br />
        </section>

        <section>
          <h1>The Python build system</h1>
          <div>
            <img
              alt="Lot of info"
              src="./img/junior_sleeping.jpg"
              style="width: 48%; margin-left: auto; margin-right: auto; margin-bottom: 0"
            />
            <p style="font-size: 12px; margin: 0 0">Copyright of the above image owned by Bernat Gabor</p>
          </div>
        </section>

        <section>
          <h2>The Python build system</h2>
          <ul>
            <pre style="font-size: 0.44em"><code class="lang-bash" data-trim data-noescape>
            pip wheel -w --no-deps /tmp/prj
            pyproject-build -w .
            </code></pre>
            In order to build a wheel, two distinct components work together:
            <li class="fragment">
              build backend (<a href="https://pypi.org/project/setuptools">setuptools</a>,
              <a href="https://pypi.org/project/hatchling">hatchling</a>,
              <a href="https://pypi.org/project/flit">flit</a>, <a href="https://pypi.org/project/poetry">poetry</a>)
              <br />
              load project configuration and build the wheel file
            </li>
            <li class="fragment">
              build frontend (<a href="https://pypi.org/project/pip">pip</a>,
              <a href="https://pypi.org/project/build">build</a>)
              <ul>
                <li>creates an isolated build environment</li>
                <li class="fragment">
                  installs the build dependencies as specified by the requires key in
                  <span style="font-style: italic">pyproject.toml</span>
                  <pre style="font-size: 0.44em"><code class="lang-toml" data-trim data-noescape>
                  [build-system]
                  build-backend = "hatchling.build"
                  requires = ["hatchling>=0.14"]
                  </code></pre>
                </li>
                <li class="fragment">
                  call the build backend via the interface defined in
                  <a href="https://peps.python.org/pep-0517/">PEP-517</a>
                  <ul>
                    <li class="fragment">
                      get runtime build dependencies and install them
                      <pre style="font-size: 0.44em"><code class="lang-python" data-trim data-noescape>
                      def get_requires_for_build_wheel(config_settings=None):
                          return ["wheel"]
                      </code></pre>
                    </li>
                    <li class="fragment">
                      perform the wheel build
                      <pre style="font-size: 0.44em"><code class="lang-python" data-trim data-noescape>
                      def build_wheel(wheel_directory, config_settings=None, metadata_directory=None):
                          ...  # e.g., for setuptools call python setup.py bdist_wheel
                      </code></pre>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h2>The Python build system</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
          $ pyproject-build -w /tmp/virtualenv
          * Creating venv isolated environment...
          * Installing packages in isolated environment... (setuptools >= 62.1.0, setuptools-scm >= 6.4)
          * Getting dependencies for wheel...
          * Installing packages in isolated environment... (wheel >= 0.37.1)
          * Building wheel...
          running bdist_wheel
          running build
          running build_py
          ...
          Successfully built virtualenv-20.14.1-py2.py3-none-any.whl
          </code></pre>
        </section>

        <section>
          <h2>The Python build system</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
          $ pyproject-build -w /tmp/virtualenv
          <mark>* Creating venv isolated environment...</mark>
          * Installing packages in isolated environment... (setuptools >= 62.1.0, setuptools-scm >= 6.4)
          * Getting dependencies for wheel...
          * Installing packages in isolated environment... (wheel >= 0.37.1)
          * Building wheel...
          running bdist_wheel
          running build
          running build_py
          ...
          Successfully built virtualenv-20.14.1-py2.py3-none-any.whl
          </code></pre>
        </section>

        <section>
          <h2>The Python build system</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
          $ pyproject-build -w /tmp/virtualenv
          * Creating venv isolated environment...
          <mark>* Installing packages in isolated environment... (setuptools >= 62.1.0, setuptools-scm >= 6.4)</mark>
          * Getting dependencies for wheel...
          * Installing packages in isolated environment... (wheel >= 0.37.1)
          * Building wheel...
          running bdist_wheel
          running build
          running build_py
          ...
          Successfully built virtualenv-20.14.1-py2.py3-none-any.whl
          </code></pre>
        </section>

        <section>
          <h2>The Python build system</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
          $ pyproject-build -w /tmp/virtualenv
          * Creating venv isolated environment...
          * Installing packages in isolated environment... (setuptools >= 62.1.0, setuptools-scm >= 6.4)
          <mark>* Getting dependencies for wheel...</mark>
          * Installing packages in isolated environment... (wheel >= 0.37.1)
          * Building wheel...
          running bdist_wheel
          running build
          running build_py
          ...
          Successfully built virtualenv-20.14.1-py2.py3-none-any.whl
          </code></pre>
        </section>

        <section>
          <h2>The Python build system</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
          $ pyproject-build -w /tmp/virtualenv
          * Creating venv isolated environment...
          * Installing packages in isolated environment... (setuptools >= 62.1.0, setuptools-scm >= 6.4)
          * Getting dependencies for wheel...
          <mark>* Installing packages in isolated environment... (wheel >= 0.37.1)</mark>
          * Building wheel...
          running bdist_wheel
          running build
          running build_py
          ...
          Successfully built virtualenv-20.14.1-py2.py3-none-any.whl
          </code></pre>
        </section>

        <section>
          <h2>The Python build system</h2>
          <pre><code class="lang-bash" data-trim data-noescape>
          $ pyproject-build -w /tmp/virtualenv
          * Creating venv isolated environment...
          * Installing packages in isolated environment... (setuptools >= 62.1.0, setuptools-scm >= 6.4)
          * Getting dependencies for wheel...
          * Installing packages in isolated environment... (wheel >= 0.37.1)
          <mark>* Building wheel...
          running bdist_wheel
          running build
          running build_py
          ...</mark>
          Successfully built virtualenv-20.14.1-py2.py3-none-any.whl
          </code></pre>
        </section>

        <section>
          <h1>The new solution</h1>
          <h5>
            Time to write a <span style="color: red">P</span>ython <span style="color: red">E</span>nhancement
            <span style="color: red">P</span>roposal
          </h5>
          <div>
            <img
              alt="Eager"
              src="./img/silky_junior_2.jpg"
              style="width: 60%; margin-left: auto; margin-right: auto; margin-bottom: 0"
            />
            <p style="font-size: 12px; margin: 0 0">Copyright of the above image owned by Bernat Gabor</p>
          </div>
        </section>

        <section>
          <h2>Two proposals</h2>
          <ul>
            <li>We could agree on what editable builds are</li>
            <li>
              We struggled to agree on:
              <ul>
                <li>How much of the complex problems we should solve?</li>
                <li>Should the build backend or the build frontend do the heavy lifting?</li>
              </ul>
            </li>
            <li class="fragment">
              In the end, we created two proposals:
              <ul>
                <li>
                  Backend does most of it -
                  <a href="https://peps.python.org/pep-0660">PEP-660 - traditional wheel based</a>
                </li>
                <li>
                  Frontend does most of it - <a href="https://peps.python.org/pep-0663">PEP-662 - virtual wheels</a>
                </li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h2>PEP-660 â€“ Editable installs for pyproject.toml based builds (wheel based)</h2>

          <ul>
            Extends the API between the build backend and frontend to build editable wheels:
            <li>
              Introduce an editable wheel build environment
              <pre><code class="lang-python" data-trim data-noescape>
                def get_requires_for_build_editable(config_settings=None):
                  ...
              </code></pre>
            </li>
            <li>
              Adds an endpoint that can provide the editable wheels metadata without building it
              <pre><code class="lang-python" data-trim data-noescape>
              def prepare_metadata_for_build_editable(metadata_directory, config_settings=None):
                  ...
            </code></pre>
            </li>
            <li>
              Adds an endpoint that builds the editable wheel
              <pre><code class="lang-python" data-trim data-noescape>
              def build_editable(wheel_directory, config_settings=None, metadata_directory=None):
                ...
              </code></pre>
            </li>
            <li>
              Mandate the frontend to create <span style="font-style: italic">direct_url.json</span> in the
              <span style="font-style: italic">.dist-info</span> folder
            </li>
          </ul>
        </section>

        <section>
          <h2>PEP-660 â€“ Editable installs for pyproject.toml based builds (wheel based)</h2>

          <ol>
            An editable instllation is made up of:
            <li>Build frontend creates an isolated build environment</li>
            <li class="fragment">
              Build frontend installs <span style="font-style: italic">build-system.requires</span> from
              <span style="font-style: italic">pyproject.toml</span>
            </li>
            <li class="fragment">
              The frontend asks the backend for dependencies needed to build an editable wheel
              <pre><code class="lang-python" data-trim data-noescape>
                def get_requires_for_build_editable(config_settings=None):
                  ...
              </code></pre>
            </li>
            <li class="fragment">Frontend installs additional dependencies</li>
            <li class="fragment">
              Frontend asks the backend to build the editable wheel
              <pre><code class="lang-python" data-trim data-noescape>
              def build_editable(wheel_directory, config_settings=None, metadata_directory=None):
                ...
              </code></pre>
            </li>
            <li class="fragment">Wheel installed into test environment via an installer per existing standards</li>
            <li class="fragment">Frontend creates <span style="font-style: italic">direct_url.json</span></li>
          </ol>
        </section>

        <section>
          <h2>PEP-660 â€“ Editable installs for pyproject.toml based builds (wheel based)</h2>

          <ul>
            <li class="fragment">
              The editable effect is handled by the build backend via the files it puts in the wheel
              <ul>
                <li>PTH</li>
                <li>import hook</li>
              </ul>
            </li>
            <li class="fragment">Backend may expose multiple ways, select via config_settings arg of build_editable</li>
            <li class="fragment">
              Backends can reuse/delegate editable logic via libraries (e.g.,
              <span style="font-style: italic">editables</span>)
            </li>
            <li class="fragment">
              Symlinks are not supported as of today
              <ul>
                <li>interested parties are invited to submit a PEP to extend the wheel standard</li>
              </ul>
            </li>
            <li class="fragment">No change for uninstallers - reusing the wheel standard takes care of it</li>
          </ul>
        </section>

        <section>
          <h2>PEP-662 â€“ Editable installs via virtual wheels</h2>
          <ul>
            <li>Interface extension between build backend and frontend is same as PEP-660</li>
            <li class="fragment">
              Similar build process, but the produced wheel artifact must contain at root
              <span style="font-style: italic">editables.json</span>
              <pre><code class="lang-json" data-trim data-noescape>
              {
                  "version": 1,
                  "scheme": {
                     "purelib": {"/src/tree/a.py": "tree/a.py"},
                     "platlib": {},
                     "data": {"/src/tree/py.typed": "tree/py.typed"},
                     "headers": {},
                     "scripts": {}
                  }
               }
              </code></pre>
            </li>
            <li class="fragment">The JSON file tells the frontend what files need to be mapped and where</li>
            <li class="fragment">
              It's up to the frontend how it makes it happen, and should allow user to select:
              <pre><code class="lang-json" data-trim data-noescape>
                pip install -e /prj --mode=symlink|pth|hook
                </code></pre>

              <ul>
                <li>Symlinks</li>
                <li>PTH</li>
                <li>sitecustomize.py</li>
                <li>import hooks</li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h2>Choosing a winner</h2>
          <ul>
            <li>
              Paul Moore is the BDFL for packaging PEPs <br />
              <img data-src="img/paul.png" style="margin-bottom: 0; border-bottom: 0" />
            </li>
            <li>two week cooldown period</li>
            <li>
              <a href="https://discuss.python.org/t/pronouncement-on-peps-660-and-662-editable-installs/9450"
                >PEP-660 announced as winner</a
              >
              on June 2021
            </li>
            <li>Primary reason given was that PEP-662 left the frontends tasks too open</li>
          </ul>
        </section>

        <section>
          <h1>Lessons learned</h1>

          <ul>
            Quick adoption by the community
            <li>
              Build frontends support
              <ul>
                <li>
                  <a href="https://pip.pypa.io/en/stable/news/#v21-3"
                    >pip support since version 21.3 (released on 2021-10-11)</a
                  >
                </li>
              </ul>
            </li>
            <li>
              Build backend support
              <ul>
                <li>pdm since 0.8 - 2021 June</li>
                <li>enscons since 0.26 - 2021 August</li>
                <li>flit since 3.4 - 2021 October</li>
                <li>hatchling since 0.3 - 2021 December</li>
                <li>poetry since 1.1 - 2022 March</li>
                <li class="fragment">
                  <a href="https://discuss.python.org/t/implementing-pep-660-for-setuptools/9193"
                    >setuptools adoption stalled</a
                  >
                  ğŸ˜” due to tech debt and not wanting a 1:1 migration
                </li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h1>Lessons learned</h1>

          <img
            alt="Silky"
            src="./img/black_swan.jpg"
            style="width: 55%; margin-left: auto; margin-right: auto; margin-bottom: 0"
          />
          <p style="font-size: 12px; margin: 0 0">
            <a href="https://commons.wikimedia.org/wiki/File:Black_Swan_2_-_Pitt_Town_Lagoon.jpg"
              >Creative Commons Attribution-Share Alike 4.0 International</a
            >
          </p>
          <ul>
            <li class="fragment">
              IDE and static checkers cannot support the dynamic aspect of import hooks
              <ul>
                <li>
                  <a href="https://discuss.python.org/t/pep-660-support-and-ides/13878/6"
                    >would require some static paths</a
                  >
                  - <span style="font-style: italic">editables.json</span>
                </li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h1>Questions?</h1>

          <ul>
            <li class="fragment">Find me after at the conference!</li>
          </ul>
        </section>

        <section>
          <h1>thank you</h1>
          <div>
            <img data-src="img/silky_junior.png" style="margin-bottom: 0; border-bottom: 0; width: 70%" />
            <p style="font-size: 12px; margin: 0 0">Copyright of the above image owned by Bernat Gabor</p>
          </div>
          <p>
            <a href="https://www.bernat.tech">https://www.bernat.tech</a>
          </p>
        </section>

        <section>
          <h1>we're hiring</h1>
          <h3><a href="https://www.TechAtBloomberg.com/python">TechAtBloomberg.com/python</a></h3>
          <h3><a href="https://bloomberg.com/engineering">bloomberg.com/engineering</a></h3>
          <p>
            <a href="https://twitter.com/techatbloomberg">@TechAtBloomberg</a>
          </p>
        </section>
      </div>
    </div>

    <div style="position: absolute; bottom: 2px; right: 2px; width: 10em; z-index: 1000">
      <p
        style="
          color: #767676;
          font-family: Helvetica, sans-serif;
          font-weight: bold;
          font-size: 1.75em;
          margin: 0 2px 2px 0;
          text-align: center;
        "
      >
        Bloomberg
      </p>
      <p style="text-align: center; font-weight: bold; font-size: 0.7em; margin: 0 auto">
        &copy; 2022 Bloomberg Finance L.P. <br />All rights reserved.
      </p>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script src="plugin/menu/menu.js"></script>
    <script src="plugin/zoom/zoom.js"></script>
    <script>
      Reveal.initialize({
        width: 1600,
        height: 900,
        margin: 0.02,
        minScale: 0.2,
        maxScale: 3.0,
        hash: true,
        dependencies: [
          { src: "plugin/highcharts.js" },
          { src: "plugin/anything/anything.js" },
          { src: "plugin/menu/menu.js" },
        ],
        history: true,
        previewLinks: true,
        navigationMode: "linear",
        transition: "none",
        viewDistance: 10,
        mobileViewDistance: 6,
        controls: false,
        controlsTutorial: false,
        progress: false,
        plugins: [RevealHighlight, RevealNotes, RevealZoom],
        anything: [
          {
            className: "plot",
            initialize: function (container, options) {
              Highcharts.chart(container, options);
            },
          },
        ],
      });
      mermaid.initialize({ startOnLoad: true });
    </script>
  </body>
</html>
